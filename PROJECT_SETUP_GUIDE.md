# Project Setup Guide - BackupDoctor

This guide will help you set up the BackupDoctor project on your local development environment.

## Prerequisites

Before starting, ensure you have the following installed:

- **PHP** >= 7.4 (PHP 8.x recommended)
- **Composer** (PHP package manager)
- **MySQL** >= 5.7 or MariaDB >= 10.3
- **Node.js** >= 14.x and **npm**
- **Git**
- **WAMP/XAMPP** (Windows) or **LAMP** (Linux) or **MAMP** (Mac)

## Step 1: Clone the Repository

```bash
git clone <repository-url>
cd backupdoctor
```

## Step 2: Install PHP Dependencies

```bash
composer install
```

This will install all PHP dependencies defined in `composer.json`.

## Step 3: Environment Configuration

1. Copy the environment file:
```bash
cp .env.example .env
```

2. Generate application key:
```bash
php artisan key:generate
```

3. Edit `.env` file and configure your database and other settings:

```env
APP_NAME="BackupDoctor"
APP_ENV=local
APP_KEY=base64:... (generated by key:generate)
APP_DEBUG=true
APP_URL=http://127.0.0.1:8000

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=backupdoctor
DB_USERNAME=root
DB_PASSWORD=

# Mail configuration (if needed)
MAIL_MAILER=smtp
MAIL_HOST=smtp.mailtrap.io
MAIL_PORT=2525
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_ENCRYPTION=null
MAIL_FROM_ADDRESS=null
MAIL_FROM_NAME="${APP_NAME}"
```

## Step 4: Database Setup

1. Create a MySQL database:
```sql
CREATE DATABASE backupdoctor CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

2. Run migrations:
```bash
php artisan migrate
```

3. (Optional) Seed the database with sample data:
```bash
php artisan db:seed
```

## Step 5: Install Frontend Dependencies

```bash
npm install
```

## Step 6: Build Frontend Assets

For development:
```bash
npm run dev
```

For production:
```bash
npm run prod
```

## Step 7: Create Storage Link

Create a symbolic link for storage:
```bash
php artisan storage:link
```

## Step 8: Set Permissions (Linux/Mac)

If you're on Linux or Mac, set proper permissions:

```bash
chmod -R 775 storage bootstrap/cache
chown -R www-data:www-data storage bootstrap/cache
```

## Step 9: Clear and Cache Configuration

```bash
# Clear all caches
php artisan config:clear
php artisan cache:clear
php artisan route:clear
php artisan view:clear

# Cache configuration (optional, for production)
php artisan config:cache
php artisan route:cache
php artisan view:cache
```

## Step 10: Start the Development Server

```bash
php artisan serve
```

The application will be available at `http://127.0.0.1:8000`

## Step 11: Create Required Directories

Ensure these directories exist and are writable:

```bash
mkdir -p public/questionnaire_uploads/temp
mkdir -p storage/app/public
mkdir -p storage/framework/cache
mkdir -p storage/framework/sessions
mkdir -p storage/framework/views
mkdir -p storage/logs
```

Set permissions:
```bash
chmod -R 775 storage public/questionnaire_uploads
```

## Step 12: Configure Web Server (Optional - Alternative to artisan serve)

### Apache Configuration

Create a virtual host configuration:

```apache
<VirtualHost *:80>
    ServerName backupdoctor.local
    DocumentRoot "C:/wamp64/www/backupdoctor/public"
    
    <Directory "C:/wamp64/www/backupdoctor/public">
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>
```

Add to `C:\Windows\System32\drivers\etc\hosts`:
```
127.0.0.1 backupdoctor.local
```

### Nginx Configuration

```nginx
server {
    listen 80;
    server_name backupdoctor.local;
    root /path/to/backupdoctor/public;

    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-Content-Type-Options "nosniff";

    index index.php;

    charset utf-8;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }

    error_page 404 /index.php;

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
    }

    location ~ /\.(?!well-known).* {
        deny all;
    }
}
```

## Step 13: Verify Installation

1. Visit `http://127.0.0.1:8000` (or your configured domain)
2. Check if the application loads without errors
3. Try accessing the login page
4. Verify database connection by checking if you can see data

## Common Issues and Solutions

### Issue: "Class not found" errors

**Solution:**
```bash
composer dump-autoload
php artisan optimize:clear
```

### Issue: "SQLSTATE[HY000] [2002] Connection refused"

**Solution:** 
- Check if MySQL is running
- Verify database credentials in `.env`
- Ensure database exists

### Issue: "Permission denied" errors

**Solution:**
```bash
chmod -R 775 storage bootstrap/cache
chown -R www-data:www-data storage bootstrap/cache  # Linux
```

### Issue: "Route not found" errors

**Solution:**
```bash
php artisan route:clear
php artisan route:cache
php artisan optimize:clear
```

### Issue: "View not found" errors

**Solution:**
```bash
php artisan view:clear
php artisan view:cache
```

### Issue: Storage link not working

**Solution:**
```bash
php artisan storage:link
# If link exists, remove it first:
rm public/storage  # Linux/Mac
rmdir public\storage  # Windows
php artisan storage:link
```

## Development Workflow

### Running Tests

```bash
php artisan test
```

### Code Style Fixing

```bash
# If using Laravel Pint
./vendor/bin/pint

# If using PHP CS Fixer
./vendor/bin/php-cs-fixer fix
```

### Watching Frontend Changes

```bash
npm run dev -- --watch
```

### Database Migrations

Create a new migration:
```bash
php artisan make:migration create_table_name
```

Run migrations:
```bash
php artisan migrate
```

Rollback last migration:
```bash
php artisan migrate:rollback
```

### Seeding Database

```bash
php artisan db:seed
# Or specific seeder
php artisan db:seed --class=SpecificSeeder
```

## Project Structure Overview

```
backupdoctor/
├── app/                    # Application logic
│   ├── Http/
│   │   └── Controllers/    # Controllers
│   ├── Models/             # Eloquent models
│   ├── Services/           # Business logic services
│   └── ...
├── database/
│   ├── migrations/         # Database migrations
│   └── seeds/             # Database seeders
├── public/                 # Public web root
│   ├── index.php          # Entry point
│   └── ...
├── resources/
│   ├── views/             # Blade templates
│   └── ...
├── routes/
│   ├── web.php            # Web routes
│   └── api.php            # API routes
├── storage/               # Storage directory
└── .env                   # Environment configuration
```

## Key Features Implemented

### Questionnaire System

- Category-based questionnaire flow
- Section-wise navigation
- File upload support (Birth Certificate, etc.)
- Answer persistence
- Authentication gate
- Validation and flagging

### Routes

- `/categories` - Categories landing page
- `/category/{id}` - Category detail page
- `/questionnaire/category/{categoryId}/section/{sectionIndex}` - Questionnaire sections
- `/questionnaire/category/{categoryId}/submit` - Submit questionnaire
- `/questionnaire/category/{categoryId}/success` - Success page

## Additional Notes

1. **Session Driver**: Make sure session driver is set correctly in `.env` (file, database, or redis)

2. **Queue Configuration**: If using queues, configure queue driver and run:
   ```bash
   php artisan queue:work
   ```

3. **Scheduler**: For cron jobs, add to crontab:
   ```bash
   * * * * * cd /path-to-project && php artisan schedule:run >> /dev/null 2>&1
   ```

4. **Debug Mode**: Set `APP_DEBUG=true` in `.env` for development, `false` for production

5. **Cache**: For better performance in production:
   ```bash
   php artisan config:cache
   php artisan route:cache
   php artisan view:cache
   ```

## Troubleshooting

If you encounter any issues:

1. Check Laravel logs: `storage/logs/laravel.log`
2. Clear all caches: `php artisan optimize:clear`
3. Regenerate autoload: `composer dump-autoload`
4. Check PHP version: `php -v` (should be >= 7.4)
5. Check extensions: `php -m` (ensure required extensions are installed)

## Getting Help

- Check Laravel documentation: https://laravel.com/docs
- Review project documentation files:
  - `QUESTIONNAIRE_FRONTEND_DELIVERABLES.md`
  - `QUESTIONNAIRE_FIXES_REPORT.md`
  - `PROJECT_ANALYSIS.md`

## Next Steps After Setup

1. Create a user account (or use seeded data)
2. Test the questionnaire flow:
   - Browse categories
   - View category details
   - Take a questionnaire
   - Submit questionnaire
3. Test file uploads
4. Verify all features are working

---

**Last Updated**: January 2025
**Laravel Version**: Check `composer.json`
**PHP Version Required**: >= 7.4
